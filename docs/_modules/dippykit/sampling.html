

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>dippykit.sampling &mdash; dippykit  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> dippykit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install_guide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.html">dippykit package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.adjustments.html">dippykit.adjustments module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.coding.html">dippykit.coding module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.image_io.html">dippykit.image_io module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.metrics.html">dippykit.metrics module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.sampling.html">dippykit.sampling module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.transforms.html">dippykit.transforms module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.utilities.html">dippykit.utilities module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.visualization.html">dippykit.visualization module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dippykit.windows.html">dippykit.windows module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dippykit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>dippykit.sampling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for dippykit.sampling</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module of various image sampling functions</span>

<span class="sd">This module contains an assortment of functions that sample images in various</span>
<span class="sd">useful manners.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># This library was developed for the Georgia Tech graduate course ECE 6258:</span>
<span class="c1"># Digital Image Processing with Professor Ghassan AlRegib.</span>
<span class="c1"># For comments and feedback, please email dippykit[at]gmail.com</span>

<span class="c1"># Internal imports</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_utils</span>

<span class="c1"># Functional imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Brighton Ancelin, Motaz Alfarraj, Ghassan AlRegib&#39;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_downsample&#39;</span><span class="p">,</span> <span class="s1">&#39;_upsample&#39;</span><span class="p">,</span> <span class="s1">&#39;resample&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_downsample</span><span class="p">(</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">ds_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Downsamples an image based on a given downsampling matrix.</span>

<span class="sd">    **This function should seldom ever be used. Instead, one should often</span>
<span class="sd">    use :func:`resample`. The :func:`resample` function can do everything</span>
<span class="sd">    that this function can do and more. This function is faster than the</span>
<span class="sd">    :func:`resample` function for downsampling without interpolation.**</span>

<span class="sd">    Downsamples an image by the given downsampling matrix argument,</span>
<span class="sd">    ds_matrix. For an input domain vector **mn** = [**m**, **n**] and an input</span>
<span class="sd">    image **f** (**mn**), the output image **g** (**.**) is defined by **g**</span>
<span class="sd">    (**mn**) = **f** (**M** @ **mn**) where **M** is the downsampling matrix</span>
<span class="sd">    ds_matrix.</span>

<span class="sd">    :type image: ``numpy.ndarray``</span>
<span class="sd">    :param image: An image to be downsampled.</span>
<span class="sd">    :type ds_matrix: ``numpy.ndarray`` (dtype must be integer)</span>
<span class="sd">    :param ds_matrix: The downsampling matrix **M** to be used.</span>
<span class="sd">    :rtype: ``numpy.ndarray``</span>
<span class="sd">    :return: The downsampled image</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; image = np.array([[ 0,  1,  2,  3,  4,  5,  6,  7],</span>
<span class="sd">    ...                   [10, 11, 12, 13, 14, 15, 16, 17],</span>
<span class="sd">    ...                   [20, 21, 22, 23, 24, 25, 26, 27],</span>
<span class="sd">    ...                   [30, 31, 32, 33, 34, 35, 36, 37],</span>
<span class="sd">    ...                   [40, 41, 42, 43, 44, 45, 46, 47],</span>
<span class="sd">    ...                   [50, 51, 52, 53, 54, 55, 56, 57],</span>
<span class="sd">    ...                   [60, 61, 62, 63, 64, 65, 66, 67],</span>
<span class="sd">    ...                   [70, 71, 72, 73, 74, 75, 76, 77]])</span>
<span class="sd">    &gt;&gt;&gt; M = np.array([[2, 0], [0, 2]])</span>
<span class="sd">    &gt;&gt;&gt; downsampled_image = downsample(image, M)</span>
<span class="sd">    &gt;&gt;&gt; downsampled_image</span>
<span class="sd">    array([[ 0.,  2.,  4.,  6.],</span>
<span class="sd">           [20., 22., 24., 26.],</span>
<span class="sd">           [40., 42., 44., 46.],</span>
<span class="sd">           [60., 62., 64., 66.]])</span>
<span class="sd">    &gt;&gt;&gt; M2 = np.array([[1, 2], [2, 1]])</span>
<span class="sd">    &gt;&gt;&gt; downsample(downsampled_image, M2)</span>
<span class="sd">    array([[ 0.,  0.,  0., 60.],</span>
<span class="sd">           [ 0.,  0., 42.,  0.],</span>
<span class="sd">           [ 0., 24., 66.,  0.],</span>
<span class="sd">           [ 6.,  0.,  0.,  0.]])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">ds_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;ds_matrix&#39; must be an &quot;</span> \
            <span class="s2">&quot;ndarray with shape (2, 2)&quot;</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">ds_matrix</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">),</span> <span class="s2">&quot;Argument &quot;</span> \
            <span class="s2">&quot;&#39;ds_matrix&#39; must be an ndarray with an integer dtype&quot;</span>
    <span class="n">ds_matrix_det</span> <span class="o">=</span> <span class="n">ds_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ds_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> \
            <span class="o">-</span> <span class="n">ds_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ds_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">ds_matrix_det</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;ds_matrix&#39; must be nonsingular&quot;</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ds_matrix_inv_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">ds_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">ds_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">ds_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ds_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]])</span>
    <span class="n">kl_extrema</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mn_extrema</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">ds_matrix_det</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ds_matrix_inv_scaled</span> <span class="o">@</span> <span class="n">kl_extrema</span><span class="p">)</span>
    <span class="n">m_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">m_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">n_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">n_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">kl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="n">ds_matrix_inv_scaled</span> <span class="o">@</span> <span class="n">kl</span>
    <span class="n">mn_lattice_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">mn</span> <span class="o">%</span> <span class="n">ds_matrix_det</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">ds_matrix_det</span><span class="p">)</span> <span class="o">*</span> <span class="n">mn</span><span class="p">[:,</span> <span class="n">mn_lattice_indices</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">kl</span> <span class="o">=</span> <span class="n">kl</span><span class="p">[:,</span> <span class="n">mn_lattice_indices</span><span class="p">]</span>
    <span class="n">ds_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">m_max</span> <span class="o">-</span> <span class="n">m_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n_max</span> <span class="o">-</span> <span class="n">n_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)))</span>
    <span class="n">mn_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">m_min</span><span class="p">],</span> <span class="p">[</span><span class="n">n_min</span><span class="p">]]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">ds_image</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">mn</span> <span class="o">-</span> <span class="n">mn_offset</span><span class="p">)]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">kl</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">ds_image</span>


<span class="k">def</span> <span class="nf">_upsample</span><span class="p">(</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">us_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Upsamples an image based on a given upsampling matrix.</span>

<span class="sd">    **This function should seldom ever be used. Instead, one should often</span>
<span class="sd">    use :func:`resample`. The :func:`resample` function can do everything</span>
<span class="sd">    that this function can do and more. This function is faster than the</span>
<span class="sd">    :func:`resample` function for upsampling without interpolation.**</span>

<span class="sd">    Upsamples an image by the given upsampling matrix argument, us_matrix.</span>
<span class="sd">    For an input domain vector **mn** = [**m**, **n**] and an input</span>
<span class="sd">    image **f** (**mn**), the output image **g** (**.**) is defined by **g**</span>
<span class="sd">    (**mn**) = **f** (**M** @ **mn**) where **M** is the upsampling matrix</span>
<span class="sd">    us_matrix.</span>

<span class="sd">    :type image: ``numpy.ndarray``</span>
<span class="sd">    :param image: An image to be upsampled.</span>
<span class="sd">    :type us_matrix: ``numpy.ndarray``</span>
<span class="sd">    :param us_matrix: The upsampling matrix **M** to be used.</span>
<span class="sd">    :rtype: ``numpy.ndarray``</span>
<span class="sd">    :return: The upsampled image</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; image = np.array([[ 0,  1,  2,  3],</span>
<span class="sd">    ...                   [10, 11, 12., 13],</span>
<span class="sd">    ...                   [20, 21, 22., 23],</span>
<span class="sd">    ...                   [30, 31, 32., 33]])</span>
<span class="sd">    &gt;&gt;&gt; M = np.array([[1/2, 0], [0, 1/2]])</span>
<span class="sd">    &gt;&gt;&gt; upsample(image, M)</span>
<span class="sd">    array([[ 0.,  0.,  1.,  0.,  2.,  0.,  3.],</span>
<span class="sd">           [ 0.,  0.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="sd">           [10.,  0., 11.,  0., 12.,  0., 13.],</span>
<span class="sd">           [ 0.,  0.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="sd">           [20.,  0., 21.,  0., 22.,  0., 23.],</span>
<span class="sd">           [ 0.,  0.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="sd">           [30.,  0., 31.,  0., 32.,  0., 33.]])</span>
<span class="sd">    &gt;&gt;&gt; M2 = np.array([[-1/3, -2/3], [-2/3, -1/3]])</span>
<span class="sd">    &gt;&gt;&gt; upsample(image, M2)</span>
<span class="sd">    array([[ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  3.],</span>
<span class="sd">           [ 0.,  0.,  0.,  0.,  0.,  0.,  0., 13.,  0.,  0.],</span>
<span class="sd">           [ 0.,  0.,  0.,  0.,  0., 23.,  0.,  0.,  2.,  0.],</span>
<span class="sd">           [ 0.,  0.,  0., 33.,  0.,  0., 12.,  0.,  0.,  0.],</span>
<span class="sd">           [ 0.,  0.,  0.,  0., 22.,  0.,  0.,  1.,  0.,  0.],</span>
<span class="sd">           [ 0.,  0., 32.,  0.,  0., 11.,  0.,  0.,  0.,  0.],</span>
<span class="sd">           [ 0.,  0.,  0., 21.,  0.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="sd">           [ 0., 31.,  0.,  0., 10.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="sd">           [ 0.,  0., 20.,  0.,  0.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="sd">           [30.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.]])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">us_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;us_matrix&#39; must be an &quot;</span> \
            <span class="s2">&quot;ndarray with shape (2, 2)&quot;</span>
    <span class="n">us_matrix_det</span> <span class="o">=</span> <span class="n">us_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">us_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> \
            <span class="o">-</span> <span class="n">us_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">us_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">us_matrix_det</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;us_matrix&#39; must be nonsingular&quot;</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">us_matrix_inv</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">us_matrix_det</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">us_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">us_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">us_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">us_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">kl_extrema</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<div class="viewcode-block" id="resample"><a class="viewcode-back" href="../../dippykit.sampling.html#dippykit.sampling.resample">[docs]</a>    <span class="n">mn_extrema</span> <span class="o">=</span> <span class="n">us_matrix_inv</span> <span class="o">@</span> <span class="n">kl_extrema</span>
    <span class="n">m_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">m_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">n_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">n_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">kl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="n">us_matrix_inv</span> <span class="o">@</span> <span class="n">kl</span>
    <span class="n">us_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m_max</span> <span class="o">-</span> <span class="n">m_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">-</span> <span class="n">n_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">mn_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">m_min</span><span class="p">],</span> <span class="p">[</span><span class="n">n_min</span><span class="p">]])</span>
    <span class="n">us_image</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">mn</span> <span class="o">-</span> <span class="n">mn_offset</span><span class="p">)]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">kl</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">us_image</span>


<span class="k">def</span> <span class="nf">resample</span><span class="p">(</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">rs_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Resamples an image based on a given resampling matrix.</span>

<span class="sd">    Resamples an image by the given resampling matrix argument, rs_matrix.</span>
<span class="sd">    For an input domain vector **mn** = [**n**, **m**] and an input</span>
<span class="sd">    image **f** (**mn**), the output image **g** (**.**) is defined by **g**</span>
<span class="sd">    (**mn**) = **f** (**M** @ **mn**) where **M** is the resampling matrix</span>
<span class="sd">    (rs_matrix) and the @ symbol denotes matrix multiplication.</span>

<span class="sd">    :type image: ``numpy.ndarray``</span>
<span class="sd">    :param image: An image to be resampled.</span>
<span class="sd">    :type rs_matrix: ``numpy.ndarray``</span>
<span class="sd">    :param rs_matrix: The resampling matrix **M** to be used.</span>
<span class="sd">    :rtype: ``numpy.ndarray``</span>
<span class="sd">    :return: The resampled image.</span>

<span class="sd">    :Keyword Arguments:</span>
<span class="sd">        * **interpolation** (``str``) --</span>
<span class="sd">          (default=None) The interpolation method used during the</span>
<span class="sd">          resampling. The lack of an interpolation method will lead to a</span>
<span class="sd">          resampling where only pixels that perfectly map across the input</span>
<span class="sd">          and output domains are included. This typically only works well</span>
<span class="sd">          for resampling matrices that contain only integer entries (which</span>
<span class="sd">          will downsample), or the inverses of such matrices (which will</span>
<span class="sd">          upsample).</span>

<span class="sd">          The interpolation keyword argument can take on any of the</span>
<span class="sd">          following values (For more information, see `cv2.warpAffine`_):</span>

<span class="sd">            * &#39;**nearest**&#39; (See cv2.INTER_NEAREST)</span>
<span class="sd">            * &#39;**linear**&#39; or &#39;**bilinear**&#39; (See cv2.INTER_LINEAR)</span>
<span class="sd">            * &#39;**area**&#39; (See cv2.INTER_AREA)</span>
<span class="sd">            * &#39;**cubic**&#39; or &#39;**bicubic**&#39; (See cv2.INTER_CUBIC)</span>
<span class="sd">            * &#39;**lanczos4**&#39; (See cv2.INTER_LANCZOS4)</span>
<span class="sd">        * **crop** (``bool``) --</span>
<span class="sd">          (default=False) Whether or not to crop the output image. If this</span>
<span class="sd">          keyword argument is specified to be ``True`` without specifying a</span>
<span class="sd">          crop_size keyword argument, then the crop_size will be set to the</span>
<span class="sd">          original size of the input image by default.</span>
<span class="sd">        * **crop_size** (``ShapeType``) --</span>
<span class="sd">          (default=image.shape) The dimensions of the output image after</span>
<span class="sd">          cropping. An integer argument signifies dimension in pixels,</span>
<span class="sd">          a floating point argument signifies dimension in proportion to the</span>
<span class="sd">          output image size (before cropping). A single value will yield a</span>
<span class="sd">          square output image.</span>

<span class="sd">    .. _cv2.warpAffine: https://docs.opencv.org/2.4/modules/imgproc/doc</span>
<span class="sd">        /geometric_transformations.html?#void%20warpAffine(InputArray%20src,</span>
<span class="sd">        %20OutputArray%20dst,%20InputArray%20M,%20Size%20dsize,%20int</span>
<span class="sd">        %20flags,%20int%20borderMode,%20const%20Scalar&amp;%20borderValue)</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; image = np.array([[ 0,  1,  2,  3],</span>
<span class="sd">    ...                   [10, 11, 12, 13],</span>
<span class="sd">    ...                   [20, 21, 22, 23],</span>
<span class="sd">    ...                   [30, 31, 32, 33]])</span>
<span class="sd">    &gt;&gt;&gt; M = np.array([[1/2, 0], [0, 1/2]])</span>
<span class="sd">    &gt;&gt;&gt; resample(image, M)</span>
<span class="sd">    array([[ 0,  0,  1,  0,  2,  0,  3],</span>
<span class="sd">           [ 0,  0,  0,  0,  0,  0,  0],</span>
<span class="sd">           [10,  0, 11,  0, 12,  0, 13],</span>
<span class="sd">           [ 0,  0,  0,  0,  0,  0,  0],</span>
<span class="sd">           [20,  0, 21,  0, 22,  0, 23],</span>
<span class="sd">           [ 0,  0,  0,  0,  0,  0,  0],</span>
<span class="sd">           [30,  0, 31,  0, 32,  0, 33]])</span>
<span class="sd">    &gt;&gt;&gt; resample(image, M, interp=&#39;lin&#39;)</span>
<span class="sd">    array([[ 0,  0,  1,  1,  2,  2,  3],</span>
<span class="sd">           [ 5,  5,  6,  6,  7,  7,  8],</span>
<span class="sd">           [10, 10, 11, 11, 12, 12, 13],</span>
<span class="sd">           [15, 15, 16, 16, 17, 17, 18],</span>
<span class="sd">           [20, 20, 21, 21, 22, 22, 23],</span>
<span class="sd">           [25, 25, 26, 26, 27, 27, 28],</span>
<span class="sd">           [30, 30, 31, 31, 32, 32, 33]])</span>
<span class="sd">    &gt;&gt;&gt; image_float = image.astype(float)</span>
<span class="sd">    &gt;&gt;&gt; resample(image_float, M, interp=&#39;lin&#39;)</span>
<span class="sd">    array([[ 0. ,  0.5,  1. ,  1.5,  2. ,  2.5,  3. ],</span>
<span class="sd">           [ 5. ,  5.5,  6. ,  6.5,  7. ,  7.5,  8. ],</span>
<span class="sd">           [10. , 10.5, 11. , 11.5, 12. , 12.5, 13. ],</span>
<span class="sd">           [15. , 15.5, 16. , 16.5, 17. , 17.5, 18. ],</span>
<span class="sd">           [20. , 20.5, 21. , 21.5, 22. , 22.5, 23. ],</span>
<span class="sd">           [25. , 25.5, 26. , 26.5, 27. , 27.5, 28. ],</span>
<span class="sd">           [30. , 30.5, 31. , 31.5, 32. , 32.5, 33. ]])</span>
<span class="sd">    &gt;&gt;&gt; resample(image_float, M, interp=&#39;lin&#39;, crop=True, crop_size=(4,3))</span>
<span class="sd">    array([[ 6. ,  6.5,  7. ],</span>
<span class="sd">           [11. , 11.5, 12. ],</span>
<span class="sd">           [16. , 16.5, 17. ],</span>
<span class="sd">           [21. , 21.5, 22. ]])</span>
<span class="sd">    &gt;&gt;&gt; M2 = np.array([[2, 0], [0, 2]])</span>
<span class="sd">    &gt;&gt;&gt; resample(image, M2)</span>
<span class="sd">    array([[ 0,  2],</span>
<span class="sd">           [20, 22]])</span>
<span class="sd">    &gt;&gt;&gt; M3 = np.array([[-1, 0], [0, 1]])</span>
<span class="sd">    &gt;&gt;&gt; resample(image, M3)</span>
<span class="sd">    array([[ 3,  2,  1,  0],</span>
<span class="sd">           [13, 12, 11, 10],</span>
<span class="sd">           [23, 22, 21, 20],</span>
<span class="sd">           [33, 32, 31, 30]])</span>
<span class="sd">    &gt;&gt;&gt; theta = np.pi / 2</span>
<span class="sd">    &gt;&gt;&gt; M4 = np.array([[ np.cos(theta), -np.sin(theta)],</span>
<span class="sd">    ...                [ np.sin(theta),  np.cos(theta)]])</span>
<span class="sd">    &gt;&gt;&gt; resample(image, M4)</span>
<span class="sd">    array([[ 3, 13, 23, 33],</span>
<span class="sd">           [ 2, 12, 22, 32],</span>
<span class="sd">           [ 1, 11, 21, 31],</span>
<span class="sd">           [ 0, 10, 20, 30]])</span>
<span class="sd">    &gt;&gt;&gt; theta = np.pi / 4</span>
<span class="sd">    &gt;&gt;&gt; M5 = np.array([[ np.cos(theta), -np.sin(theta)],</span>
<span class="sd">    ...                [ np.sin(theta),  np.cos(theta)]])</span>
<span class="sd">    &gt;&gt;&gt; resample(image, M5, interp=&#39;nearest&#39;)</span>
<span class="sd">    array([[ 0,  0,  3,  0,  0],</span>
<span class="sd">           [ 0,  1, 12, 13,  0],</span>
<span class="sd">           [ 0, 11, 11, 22, 33],</span>
<span class="sd">           [ 0, 10, 21, 31,  0],</span>
<span class="sd">           [ 0,  0, 30,  0,  0]])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">resample_no_interp</span><span class="p">():</span>
        <span class="n">rs_matrix_scaled_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">resolution_factor</span> <span class="o">*</span> <span class="n">rs_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">rs_matrix_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">rs_matrix</span><span class="p">)</span>
        <span class="c1"># Create a matrix where each column is a coordinate of one of the</span>
        <span class="c1"># corners in the domain of the input image (kl-space)</span>
        <span class="n">kl_extrema</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> \
                <span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Convert the extrema in input image domain (kl-space) to output image</span>
        <span class="c1"># domain (mn-space)</span>
        <span class="n">mn_extrema</span> <span class="o">=</span> <span class="n">rs_matrix_inv</span> <span class="o">@</span> <span class="n">kl_extrema</span>
        <span class="c1"># Determine the minimum and maximum values of each coordinate possible.</span>
        <span class="c1"># We fix the values (round towards 0) because only integer values of mn</span>
        <span class="c1"># will be actual pixels</span>
        <span class="n">m_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">m_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">n_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">n_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Create a matrix where each column is a coordinate in output image</span>
        <span class="c1"># domain (mn-space) and the set of all columns is the set of all pixels</span>
        <span class="c1"># in the output image</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">m_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_min</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Convert the output image domain (mn-space) to input image domain,</span>
        <span class="c1"># but have every value scaled by resolution_factor (this keeps</span>
        <span class="c1"># everything as integers)</span>
        <span class="n">kl_scaled</span> <span class="o">=</span> <span class="n">rs_matrix_scaled_int</span> <span class="o">@</span> <span class="n">mn</span>
        <span class="c1"># The only output image coordinates that will retain a pixel value from</span>
        <span class="c1"># the input image are those that perfectly map from integer kl values</span>
        <span class="c1"># to integer mn values. The mask of these valid lattice coordinates</span>
        <span class="c1"># in the mn and kl coordinate matrices is created below.</span>
        <span class="n">lattice_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">kl_scaled</span> <span class="o">%</span> <span class="n">resolution_factor</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Mask and scale down kl_scaled to create kl for next masking</span>
        <span class="n">kl</span> <span class="o">=</span> <span class="p">(</span><span class="n">kl_scaled</span><span class="p">[:,</span> <span class="n">lattice_mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">resolution_factor</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Only non-negative kl values within the kl max values (height and</span>
        <span class="c1"># width) will correspond to pixels in the input image.</span>
        <span class="n">domain_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">kl</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">width</span><span class="p">],</span> <span class="p">[</span><span class="n">height</span><span class="p">]])</span> <span class="o">&gt;</span> <span class="n">kl</span><span class="p">),</span>
                             <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Mask the domains to only valid values</span>
        <span class="n">kl</span> <span class="o">=</span> <span class="n">kl</span><span class="p">[:,</span> <span class="n">domain_mask</span><span class="p">]</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="p">(</span><span class="n">mn</span><span class="p">[:,</span> <span class="n">lattice_mask</span><span class="p">])[:,</span> <span class="n">domain_mask</span><span class="p">]</span>
        <span class="c1"># Create an image of 0s of the correct size</span>
        <span class="n">rs_image_height</span> <span class="o">=</span> <span class="n">n_max</span> <span class="o">-</span> <span class="n">n_min</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">rs_image_width</span> <span class="o">=</span> <span class="n">m_max</span> <span class="o">-</span> <span class="n">m_min</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">rs_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rs_image_height</span><span class="p">,</span> <span class="n">rs_image_width</span><span class="p">,</span>
                    <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rs_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rs_image_height</span><span class="p">,</span> <span class="n">rs_image_width</span><span class="p">))</span> \
                    <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="c1"># Create a column vector of the offsets in m and n</span>
        <span class="n">mn_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">m_min</span><span class="p">],</span> <span class="p">[</span><span class="n">n_min</span><span class="p">]])</span>
        <span class="c1"># Assign values from the input image to the output image accordingly</span>
        <span class="n">ix_rs</span> <span class="o">=</span> <span class="n">mn</span> <span class="o">-</span> <span class="n">mn_offset</span>
        <span class="n">ix_rs</span> <span class="o">=</span> <span class="n">ix_rs</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
        <span class="n">ix_im</span> <span class="o">=</span> <span class="n">kl</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
        <span class="n">rs_image</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ix_rs</span><span class="p">)]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ix_im</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">rs_image</span>

    <span class="k">def</span> <span class="nf">resample_interp</span><span class="p">():</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">rs_matrix_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">rs_matrix</span><span class="p">)</span>
        <span class="c1"># Create a matrix where each column is a coordinate of one of the</span>
        <span class="c1"># corners in the domain of the input image (kl-space)</span>
        <span class="n">kl_extrema</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> \
                <span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Convert the extrema in input image domain (kl-space) to output image</span>
        <span class="c1"># domain (mn-space)</span>
        <span class="n">mn_extrema</span> <span class="o">=</span> <span class="n">rs_matrix_inv</span> <span class="o">@</span> <span class="n">kl_extrema</span>
        <span class="c1"># Determine the minimum and maximum values of each coordinate possible.</span>
        <span class="c1"># We fix the values (round towards 0) because only integer values of mn</span>
        <span class="c1"># will be actual pixels</span>
        <span class="n">m_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">m_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">n_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">n_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mn_extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Restructure the rs_matrix to fit the format desired by</span>
        <span class="c1"># cv2.warpAffine()</span>
        <span class="n">aff_translation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="n">m_min</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">n_min</span><span class="p">]])</span>
        <span class="n">rs_image_dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_max</span> <span class="o">-</span> <span class="n">m_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">-</span> <span class="n">n_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">affine_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">rs_matrix_inv</span><span class="p">,</span> <span class="n">aff_translation</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Return the cv2.warpAffine() transformation of the image</span>
        <span class="k">if</span> <span class="s1">&#39;f&#39;</span> <span class="o">==</span> <span class="n">image</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">affine_mat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span>
                    <span class="n">rs_image_dims</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">image</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="s1">&#39;iub&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span>
                    <span class="n">affine_mat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">rs_image_dims</span><span class="p">,</span>
                    <span class="n">flags</span><span class="o">=</span><span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported type for interpolation: &quot;</span>
                             <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>


    <span class="n">possible_arg_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;crop&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_size&#39;</span><span class="p">,</span> <span class="s1">&#39;interpolation&#39;</span><span class="p">]</span>
    <span class="n">possible_interp_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="s1">&#39;bicubic&#39;</span><span class="p">,</span> <span class="s1">&#39;lanczos4&#39;</span><span class="p">]</span>
    <span class="n">arg_dict</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">resolve_arg_dict_from_list</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span>
                                                 <span class="n">possible_arg_list</span><span class="p">,</span> <span class="n">warn_user_missing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;interpolation&#39;</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">resolve_arg_from_list</span><span class="p">(</span>
                    <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">],</span> <span class="n">possible_interp_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;bilinear&#39;</span> <span class="o">==</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">]:</span>
                <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;bicubic&#39;</span> <span class="o">==</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">]:</span>
                <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cubic&#39;</span>
            <span class="n">interp_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;nearest&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span>
                <span class="s1">&#39;linear&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
                <span class="s1">&#39;area&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">,</span>
                <span class="s1">&#39;cubic&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_CUBIC</span><span class="p">,</span>
                <span class="s1">&#39;lanczos4&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LANCZOS4</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_dict</span><span class="p">[</span><span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">]]</span>
    <span class="k">assert</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">rs_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;rs_matrix&#39; must be an &quot;</span> \
            <span class="s2">&quot;ndarray with shape (2, 2)&quot;</span>
    <span class="c1"># The rs_matrix must contain rational entries. We define a</span>
    <span class="c1"># resolution_factor of 100 to signify that every element in rs_matrix</span>
    <span class="c1"># can be expressed as an integer divided by 100. To ensure this,</span>
    <span class="c1"># we round rs_matrix to 2 decimal places.</span>
    <span class="n">resolution_factor</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">rs_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rs_matrix</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">rs_matrix</span><span class="p">),</span> \
            <span class="s2">&quot;Argument &#39;rs_matrix&#39; must be nonsingular&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;interpolation&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arg_dict</span> <span class="ow">or</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rs_image</span> <span class="o">=</span> <span class="n">resample_no_interp</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rs_image</span> <span class="o">=</span> <span class="n">resample_interp</span><span class="p">()</span>
    <span class="n">rs_image_height</span><span class="p">,</span> <span class="n">rs_image_width</span> <span class="o">=</span> <span class="n">rs_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">arg_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;crop&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;crop_size&#39;</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="p">:</span>
            <span class="n">crop_size</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">resolve_shape_arg</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;crop_size&#39;</span><span class="p">],</span>
                                                 <span class="p">(</span><span class="n">rs_image_height</span><span class="p">,</span> <span class="n">rs_image_width</span><span class="p">),</span> <span class="s1">&#39;crop_size&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Default cropping: the input image dimensions</span>
            <span class="n">crop_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rs_image_height</span><span class="p">:</span>
            <span class="n">m_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">rs_image_height</span> <span class="o">-</span> <span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> \
                    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rs_image</span> <span class="o">=</span> <span class="n">rs_image</span><span class="p">[</span><span class="n">m_idx</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">height_diff</span> <span class="o">=</span> <span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rs_image_height</span>
            <span class="n">pad_top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">height_diff</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">pad_bottom</span> <span class="o">=</span> <span class="n">height_diff</span> <span class="o">-</span> <span class="n">pad_top</span>
            <span class="n">rs_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">rs_image</span><span class="p">,</span> <span class="p">((</span><span class="n">pad_top</span><span class="p">,</span> <span class="n">pad_bottom</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                              <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rs_image_width</span><span class="p">:</span>
            <span class="n">n_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">rs_image_width</span> <span class="o">-</span> <span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> \
                    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rs_image</span> <span class="o">=</span> <span class="n">rs_image</span><span class="p">[:,</span> <span class="n">n_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width_diff</span> <span class="o">=</span> <span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rs_image_width</span>
            <span class="n">pad_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">width_diff</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">pad_right</span> <span class="o">=</span> <span class="n">width_diff</span> <span class="o">-</span> <span class="n">pad_left</span>
            <span class="n">rs_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">rs_image</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">pad_left</span><span class="p">,</span> <span class="n">pad_right</span><span class="p">)),</span>
                              <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rs_image</span></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Brighton Ancelin, Motaz Alfarraj, Ghassan AlRegib

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>